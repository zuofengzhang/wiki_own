---
title: "使用CountLatch实现异步等待"
layout: post
date: 2019-07-03 00:00:00
category: Java
tags:
 - Java
 - Thread
 - Multi-thread
 - CountLatch

share: true
comments: true
---



# 10.async-wait-with-latch

利用CountLatch异步等待

> 摘自JavaFx源码
> 
> com.sun.javafx.application.LauncherImpl#launchApplication(java.lang.Class<? extends javafx.application.Application>, java.lang.Class<? extends javafx.application.Preloader>, java.lang.String[])


```java
// 接收异常
private static volatile RuntimeException launchException = null;


final CountDownLatch launchLatch = new CountDownLatch(1);
Thread launcherThread = new Thread(() -> {
    try {
        launchApplication1(appClass, preloaderClass, args);
    } catch (RuntimeException rte) {
        launchException = rte;
    } catch (Exception ex) {
        launchException =
            new RuntimeException("Application launch exception", ex);
    } catch (Error err) {
        launchException =
            new RuntimeException("Application launch error", err);
    } finally {
    // countDown
        launchLatch.countDown();
    }
});
launcherThread.setName("JavaFX-Launcher");
launcherThread.start();
// 异步线程启动

// Wait for FX launcher thread to finish before returning to user
try {
    launchLatch.await();
} catch (InterruptedException ex) {
    throw new RuntimeException("Unexpected exception: ", ex);
}

if (launchException != null) {
    throw launchException;
}
```